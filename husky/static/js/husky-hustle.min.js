function clearMessage(e){if(!e)e=timeOut;tID=setTimeout(function(){$(".messages").empty()},e)}function showOverlay(e){if(tID)clearTimeout(tID);if(!e)e="overlay";$("#"+e).css("display","block");$("#"+e).height($(document).height());$("#message").css("color","#000000");$("#message").css("margin-left","10px");$("#message").css("font-weight","bold");$("#message").html("Loading...Please Wait!")}function showOverlayTop(e){$(".background-cover-top").css({display:"block",width:"100%",height:$(document).height(),opacity:0,"z-index":1050}).animate({opacity:.5,backgroundColor:"#000"})}function hideOverlay(e,t){if(!e)e="overlay";$("#"+e).css("display","none");clearMessage(t)}function showOverlayBox(e,t){if(isOpen===false)return;$(e).css({display:"block",left:($(window).width()-$(e).width())/2,top:50,position:"absolute"});if(t){$(".background-cover-top").css({display:"block",width:"100%",height:$(document).height()});$(e).css({"z-index":$(e).css("z-index")+t})}else{$(".background-cover").css({display:"block",width:"100%",height:$(document).height()})}}function doOverlayOpen(e,t){formID=e;e="#overlay-box-"+e;isOpen=true;showOverlayBox(e,t);if(t){$(".background-cover-top").css({opacity:0}).animate({opacity:.5,backgroundColor:"#000"})}else{$(".background-cover").css({opacity:0}).animate({opacity:.5,backgroundColor:"#000"})}return false}function doOverlayClose(e,t){e="#overlay-box-"+e;isOpen=false;$(e).css("display","none");if(t){$(".background-cover-top").animate({opacity:0},"fast",null,function(){$(this).hide()});$(e).css({"z-index":$(e).css("z-index")-t})}else{$(".background-cover").animate({opacity:0},"fast",null,function(){$(this).hide()})}}function doOverlaySwap(e,t){overlay="#overlay-box-"+e;isOpen=false;$(overlay).css("display","none");overlay="#overlay-box-"+t;isOpen=true;showOverlayBox(overlay);return false}function reloadPage(e,t){var n=window.location.href.replace("#","");window.location=n}function showFormDonate(e,t){$("#overlay-box-add").dialog({closeOnEscape:true,minWidth:600,minHeight:100,modal:true,dialogClass:"tooltip",resizable:false,close:function(e,t){cancelForm()}})}function showFormTeacher(e,t){$("#overlay-box-teacher").dialog({closeOnEscape:true,minWidth:600,minHeight:100,modal:true,dialogClass:"tooltip",resizable:false,close:function(e,t){cancelForm()}})}function showBarChart(e){$.getJSON("/admin/reports/"+e,initBarChart)}function showTooltip(e){var t=this.id.replace("_tooltip","");$("#tooltip_"+t).dialog({closeOnEscape:true,minWidth:500,minHeight:100,dialogClass:"tooltip",resizable:false})}function submitForm(e){var t=$(this);t.button("loading");var n=$(this).attr("id").match("submit_(\\w+)");var r=$("#"+n[1]+"_form");var i=r.serialize();var s=r.attr("action");if(n[1]==="invite"){if(!$("#email_addresses").val()){alert("You must provide email addresses");return false}}if(n[1]==="reminder"||n[1]==="thanks"){$(".set-reminder").each(function(){if($(this).attr("checked")==="checked"){i+="&donators="+$(this).val()}})}$.ajax({url:s,type:"post",dataType:"json",data:i,timeout:35e3,complete:function(e){t.button("reset");updateStatus(e.responseJSON)}});return false}function submitFormAction(e){var t=this.id.replace("submit_","");var n=$("#"+t+"_form");showOverlayTop();setTimeout(function(){n.submit()},1e3)}function submitSearchForm(e){var t=this.id.replace("submit_","");var n=new RegExp("(\\w+)_(\\w+)");var r=t.match(n);if(r){t=r[2];if(r[1]==="parent"){$("#parent_only").val(1);$("#student_last_name").val("");$("#student_first_name").val("")}else{$("#parent_only").val(0);$("#parent_last_name").val("");$("#parent_first_name").val("")}}showOverlayTop();setTimeout(function(){$("#form_"+t).submit()},1e3)}function cancelOverlay(e){var t;if(e===null){t=e.keyCode}else{t=e.which}if(t===27){if(formID.match("_form")){$("#"+formID+" .cancel_button").trigger("click")}else if(formID==="edit"){$(".form-"+formID+" .cancel_button").trigger("click")}else{$("#"+formID+"_form .cancel_button").trigger("click")}cancelForm(formID,formID);formID=""}}function cancelForm(e,t){var n=$(this).attr("id");var r;if(n&&typeof n!="object"){doOverlayClose(n);if(n==="cancel_child"||n==="cancel_profile"){$(".form-edit").hide()}else if(n==="cancel_sponsor"){var i=$("#id").val();$("#sponsor").hide();$("#sponsor input").each(function(){if(this.id){var e=$("#row"+i+' td[abbr="'+this.id+'"]').text();if(this.id==="per_lap"){$(this).attr("checked",false)}else if(e){$(this).attr("value","")}}})}else{r=n.replace("cancel_","");$("#"+r+"_form").hide()}}else if(n&&typeof n==="object"&&n.name==="id"){$(".input-field").each(function(){$(this).attr("value","")})}else if(this.id&&typeof this.id!="object"){r=this.id.replace("cancel_","");$("#"+r+"_form").hide()}}function updatePage(e){updateStatus(e);if(e["status"]!=200)return;cancelFormDetails(e["form"]);path="/admin/index";path+="/limit/"+($("#limit").val()?$("#limit").val():"10");path+="/offset/"+($("#offset").val()?$("#offset").val():"0");setTimeout(function(){top.location.href=path},1200)}function updateStatus(e){if(tID)clearTimeout(tID);var t=$(".messages");if(e.status!=200){t.css("color","red")}else{t.css("color","green")}if(e.is_modal){$("#"+e.is_modal).modal("hide")}t.append("<li>"+e.message+"</li>");clearMessage()}function updateReload(e){updateStatus(e);setTimeout(function(){top.location.href=path},1200)}function setAllReminders(e){var t=$(this).attr("checked");$(".set-reminder").each(function(){$(this).attr("checked",t?true:false)})}function setPreSetAmount(e){var t=$(this).val();if(this.className.match("to-teacher")){t=$("#id_teacher :selected").val();$("#id_first_name").attr("value",t)}else{if(t){$("#id_donation").attr("value",t);$("#id_donation").attr("readonly",true)}else{$("#id_donation").attr("value","");$("#id_donation").attr("readonly",false)}}}function makeDonation(e){var t=e.id.match("payment-([\\w-]+)")[1];$("#donation_form").attr("action",e.getAttribute("action"));$("#donation_id").val(t);$("#donation_title").text("Make a Payment to "+$("#student-"+e.id).text())}function sendReminder(e){var t=e.id.match("reminder-([\\w-]+)")[1];$("#reminder_form").attr("action",e.getAttribute("action"));$("#reminder_title").text("Send a Reminder to "+$("#student-"+t).text()+"'s Sponsors ")}function disconnectSocial(e){$.getJSON($(this).attr("src"),reloadPage);return false}function runCalculations(e){doOverlayOpen("none",50);$.getJSON($(this).attr("href"),reloadPage);return false}function postToSocial(e){window.open($(this).attr("src"),"_social","height=200,width=550,resizable=yes,scrollbars=yes")}function selectAllItems(e){var t=$(".select-all-label").hasClass("active");$(".remove-item").each(function(){this.checked=t?false:true})}function removeCartItems(e){var t=$("#cart_form").attr("action");var n=function(e){var r=$.Deferred();$.ajax({url:t+e,type:"get",dataType:"json",timeout:3e3,complete:function(){r.resolve()},error:function(){n(e)}});return r.promise()};var r=[];$(".remove-item").each(function(){if(this.checked){r.push(n(this.id))}});$.when.apply($,r).done(reloadPage);return false}function initBarChart(e){var t=new $jit.BarChart({injectInto:"infovis",animate:true,orientation:"vertical",barsOffset:20,Margin:{top:5,left:5,right:5,bottom:5},labelOffset:5,type:useGradients?"stacked:gradient":"stacked",showAggregates:true,showLabels:true,Label:{type:labelType,size:13,family:"Arial",color:"white"},Tips:{enable:true,onShow:function(e,t,n){e.innerHTML="<b>"+t.name+"</b>: "+t.value}},Events:{enable:true,onClick:function(e,t,n){url="/admin/results/donations-by-teacher?id="+e.label;if(!e.label){}else if(window.location.href.match("most-donations-by-child\\?id=0")&&e.label){url="/admin/results/most-donations-by-child?id="+e.label;window.parent.location=url}else if(window.location.href.match("donations-by-teacher\\?id=0")&&e.label){window.parent.location=url}else if(window.location.href.match("donations-by-teacher\\?id=\\d+")){window.parent.location="/admin/results/donations-by-teacher"}}}});t.loadJSON(e)}function _console_log(e){if(console&&console.log){console.log("Sample of data:",e)}}var labelType,useGradients,nativeTextSupport,animate;var noAlert=true;var isOpen=false;var timeOut=12e3;var formID="";var tID="";$(".submit-form").bind("click",submitForm);$(".post-to-social").bind("click",postToSocial);$(".pre-set-amount").bind("change",setPreSetAmount);$(".to-teacher").bind("change",setPreSetAmount);$(".remove-items").bind("click",removeCartItems);$(".select-all-items").bind("change",selectAllItems);$("#modal-box-donation").on("show.bs.modal",function(e){makeDonation(e.relatedTarget)});$("#modal-box-reminder").on("show.bs.modal",function(e){sendReminder(e.relatedTarget)});(function(){var e=navigator.userAgent,t=e.match(/iPhone/i)||e.match(/iPad/i),n=typeof HTMLCanvasElement,r=n==="object"||n==="function",i=r&&typeof document.createElement("canvas").getContext("2d").fillText==="function";labelType=!r||i&&!t?"Native":"HTML";nativeTextSupport=labelType==="Native";useGradients=r;animate=!(t||!r)})();